<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/database/usable-channel.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/Gawdl3y/discord-graf.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/config.js~BotConfig.html">BotConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Bot.html">Bot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/permissions.js~Permissions.html">Permissions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/util.js~Util.html">Util</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-version">version</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ConfigObject">ConfigObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-PatternConstants">PatternConstants</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">commands</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/commands/dispatcher.js~CommandDispatcher.html">CommandDispatcher</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/commands/registry.js~CommandRegistry.html">CommandRegistry</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">database</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/mod-role.js~ModRole.html">ModRole</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/setting.js~Setting.html">Setting</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/usable-channel.js~UsableChannel.html">UsableChannel</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">errors</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/command-format.js~CommandFormatError.html">CommandFormatError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/friendly.js~FriendlyError.html">FriendlyError</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/database/usable-channel.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use babel&apos;;
&apos;use strict&apos;;

import bot from &apos;../&apos;;
import Util from &apos;../util&apos;;

export default class UsableChannel {
	static loadDatabase() {
		this.serversMap = JSON.parse(bot.storage.getItem(&apos;allowed-channels&apos;));
		if(!this.serversMap) this.serversMap = {};
	}

	static saveDatabase() {
		bot.logger.debug(&apos;Saving channels storage...&apos;, this.serversMap);
		bot.storage.setItem(&apos;allowed-channels&apos;, JSON.stringify(this.serversMap));
	}

	static save(channel) {
		if(!channel) throw new Error(&apos;A channel must be specified.&apos;);
		if(!this.serversMap) this.loadDatabase();
		if(!this.serversMap[channel.server.id]) this.serversMap[channel.server.id] = [];
		const serverChannels = this.serversMap[channel.server.id];

		if(!serverChannels.includes(channel.id)) {
			serverChannels.push(channel.id);
			bot.logger.info(&apos;Added new channel.&apos;, this.basicInfo(channel));
			this.saveDatabase();
			return true;
		} else {
			bot.logger.info(&apos;Not adding channel, because it already exists.&apos;, this.basicInfo(channel));
			return false;
		}
	}

	static delete(channel) {
		if(!channel) throw new Error(&apos;A channel must be specified.&apos;);
		if(!this.serversMap) this.loadDatabase();
		if(!this.serversMap[channel.server.id]) return false;
		const serverChannels = this.serversMap[channel.server.id];

		const roleIndex = serverChannels.findIndex(element =&gt; element === channel.id);
		if(roleIndex &gt;= 0) {
			serverChannels.splice(roleIndex, 1);
			bot.logger.info(&apos;Deleted channel.&apos;, this.basicInfo(channel));
			this.saveDatabase();
			return true;
		} else {
			bot.logger.info(&apos;Not deleting channel, because it doesn\&apos;t exist.&apos;, this.basicInfo(channel));
			return false;
		}
	}

	static clearServer(server) {
		if(!server) throw new Error(&apos;A server must be specified.&apos;);
		if(!this.serversMap) this.loadDatabase();
		delete this.serversMap[server.id];
		bot.logger.info(&apos;Cleared channels.&apos;, { server: server.name, serverID: server.id });
		this.saveDatabase();
	}

	static findInServer(server, searchString = null) {
		if(!server) throw new Error(&apos;A server must be specified.&apos;);
		if(!this.serversMap) this.loadDatabase();
		if(!this.serversMap[server.id]) return [];

		// Find all of the server&apos;s channels that match, and filter them to ones that are usable channels
		const channels = Util.search(server.channels.getAll(&apos;type&apos;, &apos;text&apos;), searchString, { searchExact: false }).filter(channel =&gt; this.serversMap[server.id].includes(channel.id));
		return Util.search(channels, searchString, { searchInexact: false });
	}

	static serverHasAny(server) {
		if(!server) throw new Error(&apos;A server must be specified.&apos;);
		if(!this.serversMap) this.loadDatabase();
		return this.serversMap[server.id] &amp;&amp; this.serversMap[server.id].length &gt; 0;
	}

	static serverHas(server, channel) {
		if(!server || !channel) throw new Error(&apos;A server and channel must be specified.&apos;);
		if(!this.serversMap) this.loadDatabase();
		return this.serversMap[server.id] &amp;&amp; this.serversMap[server.id].includes(channel.id);
	}

	static basicInfo(channel) {
		return { id: channel.id, name: channel.name, server: channel.server.name, serverID: channel.server.id };
	}
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
